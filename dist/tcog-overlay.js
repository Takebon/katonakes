!function(t){"function"==typeof define&&define.amd?define(t):t()}((function(){"use strict";var t={iconCross:()=>'\n    <svg id="icon-cross" viewBox="0 0 24 23">\n    <title>cross</title>\n    <path d="M23.865 3.677c.197-.383.164-.818-.008-1.18.048-.41-.06-.827-.448-1.147L22.323.457c-.636-.524-1.632-.689-2.25 0a155.348 155.348 0 0 1-8.797 9.001C9.011 7.342 6.72 5.255 4.443 3.165c-.8-.734-1.956-.503-2.458.37C1.253 3.9.659 4.374.168 5.182c-.233.386-.215.872 0 1.258 1.47 2.635 4.31 4.951 6.646 7.083-.313.28-.623.562-.942.836-3.146 2.702-5.268 4.416-1.331 7.187.053.037.107.029.161.05.076.036.148.06.232.074.026 0 .05.005.075.003.082.007.16.027.243.011 2.117-.415 4.085-2.074 5.872-3.9 1.74 1.715 3.592 3.353 5.63 4.325.485.232 1.063.097 1.436-.227.626.047 1.197-.342 1.484-.901.042-.026.07-.041.116-.07.91-.569.993-1.701.32-2.482-1.522-1.762-3.138-3.438-4.787-5.084 2.968-2.9 6.674-6.027 8.542-9.667z"></path>\n    </svg>\n    '},e={render(){return`${this.html()}\n            ${this.css()}`},mapDOM:t=>({overlay:t.getElementById("overlay"),reveal:t.getElementById("reveal"),item:t.getElementById("item"),close:t.getElementById("close"),container:t.getElementById("gl"),title:t.getElementById("title"),count:t.getElementById("count")}),html:()=>`\n<div id='overlay'>\n<div id='reveal'></div>\n<div id='item'>\n<h1 id='title'></h1>\n<div id="gl"></div>                 \n<button id="close">${t.iconCross()}</button>\n<h2 id="count"></h2>   \n</div>\n</div>\n    `,css:()=>"\n<style>\n#overlay {\npointer-events: none;\nwidth: 100%;\nheight: 100vh;\nposition: fixed;\ntop: 0;\nleft: 0;\nz-index: 1000;\noverflow: hidden;\n}\n#icon-cross {\ndisplay: block;\nwidth: 1.5em;\nheight: 1.5em;\nmargin: 0 auto;\nfill: var(--text-color);\n}     \n.open {\npointer-events: auto !important;\n}\n#count {\nposition: absolute;\ntop: .5rem;\nleft: 1rem;\ncolor: var(--text-color);\n}\n#title {\nheight: 2rem;\ncolor: var(--text-color);        \n}        \n#close {          \ncursor: pointer;\nborder: 0;\nwidth: 2.5rem;\nheight: 2.5rem;\nposition: absolute;\ntop: 1rem;\nright: 1rem;\nbackground: none;          \nopacity: 0;\n}\n#close:focus {\noutline: none;\n}\n#reveal {\nwidth: 100%;\nheight: 100%;\ntop: 0;\nleft: 0;\nbackground: #000;\nposition: absolute;\nz-index: 100;\ntransform: translateX(100%)\n}\n#item {\ndisplay: flex;\nflex-direction: column;\nalign-items: center;\nwidth: 100%;\nheight: 100vh;          \n/*background: var(--base-color);*/\nbackground-image: radial-gradient(#596657, #364435);\nopacity: 0;\n}        \n#gl {\ndisplay: flex;\nflex-direction: column;\nalign-items: center;\nwidth: 100%;\nheight: calc(100vh - 3rem);\nmargin-bottom: .5rem;     \n}\ncanvas {\n  box-shadow: 4px 4px 16px rgba(0,0,0,0.5);              \n}\n</style>\n"},i={vertexShader:()=>"\nattribute vec2 a_position;\n\nvoid main() {\ngl_Position = vec4( a_position, 0, 1 );\n}\n",fragmentShader:()=>"\n#ifdef GL_ES\nprecision mediump float;\n#endif\n\nuniform vec4 resolution;\nuniform float time;\nuniform float pixelRatio;\nuniform sampler2D image0;\nuniform sampler2D image1;\nuniform float progress;\n\n\nfloat strength = 0.1;\n\nvec4 transition(vec2 p) {\nvec4 ca = texture2D(image0, p);\nvec4 cb = texture2D(image1, p);\n\nvec2 oa = (((ca.rg+ca.b)*0.5)*2.0-1.0);\nvec2 ob = (((cb.rg+cb.b)*0.5)*2.0-1.0);\nvec2 oc = mix(oa,ob,0.5)*strength;\n\nfloat w0 = progress;\nfloat w1 = 1.0-w0;\nreturn mix(texture2D( image0, p+oc*w0), texture2D( image1,p-oc*w1), progress);\n}\n\nvoid main() {\nvec2 uv = pixelRatio*gl_FragCoord.xy / resolution.xy ;\nvec2 vUv = (uv - vec2(0.5))*resolution.zw + vec2(0.5);\nvUv.y = 1. - vUv.y;  \ngl_FragColor = transition(vUv);  \n}\n"};class s{constructor(t,e,i,s){this.name=t,this.suffix=e,this.program=i,this.gl=s,this.location=s.getUniformLocation(i,t)}set(...t){const e="uniform"+this.suffix,i=[this.location].concat(t);this.gl[e].apply(this.gl,i)}}class n{constructor(t){this.gl=t,this.createPlane()}createPlane(){const t=this.gl.createBuffer(),e=new Float32Array([-1,-1,1,-1,-1,1,1,1]);this.gl.bindBuffer(this.gl.ARRAY_BUFFER,t),this.gl.bufferData(this.gl.ARRAY_BUFFER,e,this.gl.STATIC_DRAW)}render(){this.gl.drawArrays(this.gl.TRIANGLE_STRIP,0,4)}}class r{constructor(t,e){this.dom=t,this.urls=e,this.images=null,this.textures=[],this.loadedImages=null,this.canvas=document.createElement("canvas"),this.dom.container.appendChild(this.canvas),this.gl=this.canvas.getContext("webgl"),this.createScene(),this.loadImages(),this.dom.container.addEventListener("click",()=>{this.isRunning||(this.isRunning=!0)}),this.imagesLoaded=!1}setStart(){this.tick=0,this.current=0,this.length=0,this.startTime=(new Date).getTime(),this.progress={value:0},this.textures=[],this.tick=0,this.current=0,this.isOpened=!0}createScene(){this.program=this.gl.createProgram(),this.addShader(i.vertexShader(),this.gl.VERTEX_SHADER),this.addShader(i.fragmentShader(),this.gl.FRAGMENT_SHADER),this.gl.linkProgram(this.program),this.gl.useProgram(this.program),this.uResolution=new s("resolution","4f",this.program,this.gl),this.uTime=new s("time","1f",this.program,this.gl),this.uRatio=new s("pixelRatio","1f",this.program,this.gl),this.uProgress=new s("progress","1f",this.program,this.gl),this.billboard=new n(this.gl);const t=this.gl.getAttribLocation(this.program,"a_position");this.gl.enableVertexAttribArray(t),this.gl.vertexAttribPointer(t,2,this.gl.FLOAT,!1,0,0)}addShader(t,e){const i=this.gl.createShader(e);this.gl.shaderSource(i,t),this.gl.compileShader(i);if(!this.gl.getShaderParameter(i,this.gl.COMPILE_STATUS))throw new Error("Shader compile error: "+this.gl.getShaderInfoLog(i));this.gl.attachShader(this.program,i)}loadImages(){const t={};let e=0;for(let t in this.urls)e+=this.urls[t].length;for(let i in this.urls){t[i]=[];for(let s of this.urls[i]){const n=new Image;n.crossOrigin="",n.addEventListener("load",()=>{if(t[i].push(n),--e,0===e){this.images=t,this.imagesLoaded=!0;document.querySelector(".loader").style.display="none"}}),n.src=s}}}runSlider(t){if(!this.imagesLoaded)return;this.setStart();const e=this.images[t];if(e.length){this.length=e.length,1===e.length&&(this.length=1,e[1]=e[0]),this.dom.count.innerText=`${this.current+1} / ${this.length}`,this.imageAspect=e[0].naturalHeight/e[0].naturalWidth;for(let t=0;t<e.length;t++){const i=this.gl.createTexture();this.gl.bindTexture(this.gl.TEXTURE_2D,i),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,e[t]),this.textures.push(i)}this.u_image0Location=this.gl.getUniformLocation(this.program,"image0"),this.u_image1Location=this.gl.getUniformLocation(this.program,"image1"),this.gl.activeTexture(this.gl.TEXTURE0+0),this.gl.bindTexture(this.gl.TEXTURE_2D,this.textures[0]),this.gl.uniform1i(this.u_image0Location,0),this.gl.activeTexture(this.gl.TEXTURE0+1),this.gl.bindTexture(this.gl.TEXTURE_2D,this.textures[1]),this.gl.uniform1i(this.u_image1Location,1),this.resize(),this.loop()}}swapTexture(){const t=this.textures.length,e=this.textures[(this.current+1)%t];this.gl.activeTexture(this.gl.TEXTURE0+0),this.gl.bindTexture(this.gl.TEXTURE_2D,e),this.gl.uniform1i(this.u_image0Location,0),this.progress.value=0,this.tick=0,this.current=(this.current+1)%t,this.gl.activeTexture(this.gl.TEXTURE0+1),this.gl.bindTexture(this.gl.TEXTURE_2D,this.textures[(this.current+1)%t]),this.gl.uniform1i(this.u_image1Location,1),this.isRunning=!1,this.dom.count.innerText=`${this.current+1} / ${this.length}`}loop(){this.isRunning&&(this.tick+=.02,this.progress.value=this.tick<.5?4*this.tick*this.tick*this.tick:1-Math.pow(-2*this.tick+2,3)/2,this.progress.value>1&&(this.progress.value=1,this.swapTexture()));const t=((new Date).getTime()-this.startTime)/1e3;this.uTime.set(t),this.uProgress.set(this.progress.value),this.billboard.render(this.gl),this.isOpened&&requestAnimationFrame(this.loop.bind(this))}resize(){this.resizeHandler(),window.addEventListener("resize",this.resizeHandler.bind(this))}resizeHandler(){const t=window.devicePixelRatio;let e=this.dom.container.offsetWidth,i=this.dom.container.offsetHeight;const s=i/e;let n,r;e>1125&&i>832?(e=1125,i=832):e>1125&&i<832?e=i/this.imageAspect:e<1125&&i>832?i=e*this.imageAspect:e<1125&&i<832&&(s>this.imageAspect?i=e*this.imageAspect:e=i/this.imageAspect),this.canvas.width=e*t,this.canvas.height=i*t,this.canvas.style.width=e+"px",this.canvas.style.height=i+"px",i/e<this.imageAspect?(n=1,r=i/e/this.imageAspect):(n=e/i*this.imageAspect,r=1),this.uResolution.set(e,i,n,r),this.uRatio.set(1/t),this.gl.viewport(0,0,e*t,i*t)}}class o extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"}),this.urls={}}getURLs(){window.showcaseData.documents.forEach(t=>{let e=[];t.fields.images.arrayValue.values&&t.fields.images.arrayValue.values.forEach(t=>{e.push(t.stringValue)}),this.urls[t.fields.id.stringValue]=e})}connectedCallback(){this.shadowRoot.innerHTML=e.render(),this.dom=e.mapDOM(this.shadowRoot),this.getURLs(),this.slider=new r(this.dom,this.urls),this.dom.close.addEventListener("click",()=>this.close())}static get observedAttributes(){return["showcase"]}attributeChangedCallback(t,e,i){i&&(this.text=this.getAttribute("text").toUpperCase(),this.dom.title.innerText=this.text,this.slider.runSlider(i))}open(){this.dom.overlay.classList.add("open"),gsap.to(this.dom.reveal,{duration:.5,ease:"Power1.easeInOut",x:"0%",onComplete:()=>{document.body.style.overflow="hidden",this.revealItem(),gsap.to(this.dom.reveal,{duration:.5,ease:"Power1.easeInOut",x:"-100%"})}})}revealItem(){this.dom.item.style.opacity=1,this.dom.close.style.opacity=1}hideItem(){this.dom.item.style.opacity=0,this.dom.close.style.opacity=0}close(){this.slider.isOpened=!1,gsap.to(this.dom.reveal,{duration:.5,ease:"Power1.easeInOut",x:"0%",onComplete:()=>{document.body.style.overflow="",this.hideItem(),gsap.to(this.dom.reveal,{duration:.5,ease:"Power1.easeInOut",x:"100%",onComplete:()=>{this.dom.overlay.classList.remove("open")}})}})}}customElements.get("tcog-overlay")||customElements.define("tcog-overlay",o)}));
